{% extends "base.html" %}

{% block title %}Inicio - Tienda{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="hero-banner mb-4">
  <div class="hero-overlay">
    <div class="container py-5">
      <div class="row">
        <div class="col-12 col-lg-7">
          <h1 class="display-5 fw-bold mb-3 text-white">üõí Tienda en L√≠nea</h1>
          <p class="lead mb-4 text-white-50">Encuentra herramientas, art√≠culos para el hogar y tecnolog√≠a con env√≠o a domicilio.</p>
          <div class="d-grid d-sm-flex gap-2 gap-sm-3">
            <a href="#productos" class="btn btn-hero-primary btn-lg w-100 w-sm-auto">Ver Productos</a>
            <a href="{{ url_for('productos.listar_productos') }}" class="btn btn-hero-secondary btn-lg w-100 w-sm-auto">Explorar Todo</a>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Categories Section -->
<div class="container mb-5">
  <h2 class="h4 mb-4 fw-bold">Categor√≠as</h2>
  <div class="row g-3">
    {% for categoria in categorias %}
    <div class="col-lg-2 col-md-3 col-sm-4 col-6">
      <a href="{{ url_for('productos.listar_productos', categoria=categoria.id) }}" class="text-decoration-none">
        <div class="category-card border rounded p-3 hover-shadow shadow-sm bg-white h-100">
          <div class="d-flex align-items-center gap-2">
            <div class="category-icon">
              {% set name_lower = categoria.nombre|lower %}
              {% if 'hogar' in name_lower %}
                <i class="fas fa-house fa-lg text-primary"></i>
              {% elif 'herramienta' in name_lower %}
                <i class="fas fa-screwdriver-wrench fa-lg text-primary"></i>
              {% elif 'electronico' in name_lower or 'electr√≥nico' in name_lower %}
                <i class="fas fa-laptop fa-lg text-primary"></i>
              {% else %}
                <i class="fas fa-tag fa-lg text-primary"></i>
              {% endif %}
            </div>
            {% set display_name = 'Electr√≥nico' if ('electronico' in name_lower) or ('electr√≥nico' in name_lower) else categoria.nombre %}
            <h6 class="mb-0 text-start">{{ display_name }}</h6>
          </div>
        </div>
      </a>
    </div>
    {% endfor %}
  </div>
</div>

<!-- Products Section -->
<div id="productos" class="container">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="h4 mb-0 fw-bold">Productos Destacados</h2>
    <a href="{{ url_for('productos.listar_productos') }}" class="btn btn-outline-primary">Ver Todos</a>
  </div>

  {% if productos %}
  <div class="row g-2">
    {% for producto in productos %}
    <div class="col-6 col-md-6 col-lg-4 col-xl-3">
      <div class="product-card card h-100 border-0 shadow-sm hover-lift">
        <div class="product-image-container position-relative overflow-hidden">
          <a href="{{ url_for('productos.detalle_producto', id=producto.id) }}" class="d-block h-100">
            {% if producto.imagen_url %}
              <img src="{{ producto.imagen_url }}" class="card-img-top w-100 h-100 object-fit-cover product-image" alt="{{ producto.nombre }}" style="cursor: pointer;">
            {% else %}
              <img src="{{ url_for('static', filename='img/no-image.png') }}" class="card-img-top w-100 h-100 object-fit-cover product-image" alt="Sin imagen" style="cursor: pointer;">
            {% endif %}
          </a>
        </div>

        <div class="card-body d-flex flex-column p-3">
          {% if producto.categoria %}
            <span class="badge bg-light text-dark mb-2 align-self-start">{{ producto.categoria.nombre }}</span>
          {% endif %}

          <h5 class="card-title mb-1 fw-bold text-truncate" title="{{ producto.nombre }}">
            {{ producto.nombre }}
          </h5>

          <div class="d-flex align-items-baseline justify-content-between mt-1">
            <span class="h5 fw-bold mb-0 text-primary">Q{{ producto.precio }}</span>
          </div>

          {% set stock = (producto.stock if producto.stock is not none else 0) %}
          <p class="small mb-2 {{ 'text-success' if stock > 0 else 'text-danger' }}">
            {{ 'En stock' if stock > 0 else 'Agotado' }}
          </p>

          <p class="card-text text-muted small mb-3 flex-grow-1" style="display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;">
            {{ producto.descripcion }}
          </p>

          <div class="mt-auto">
            <div class="d-grid gap-3">
              <a href="{{ url_for('carrito.agregar_al_carrito', id=producto.id) }}"
                 class="btn flex-fill btn-add-to-cart btn-block-mobile"
                 data-product-id="{{ producto.id }}"
                 {% if stock <= 0 %}disabled aria-disabled="true"{% endif %}>
                <i class="fas fa-cart-plus me-1"></i>Agregar al Carrito
              </a>

              <a href="{{ url_for('carrito.comprar_ahora', id=producto.id) }}" class="btn btn-buy-now flex-fill btn-block-mobile">
                <i class="fas fa-bolt me-1"></i>Comprar Ahora
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
  {% else %}
  <div class="text-center py-5">
    <i class="fas fa-box-open fa-3x text-muted mb-3"></i>
    <h4 class="text-muted">No hay productos disponibles</h4>
    <p class="text-muted">Vuelve pronto para ver nuestros productos.</p>
  </div>
  {% endif %}
</div>

<style>
/* Hero banner with background image and overlay */
.hero-banner {
  position: relative;
  overflow: hidden;
  background-color: #334;
  border-radius: 12px;
  min-height: 220px;
}
.hero-banner .hero-bg {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;
  border-radius: 12px;
}
.hero-banner .hero-overlay {
  position: relative;
  z-index: 1;
  background: linear-gradient(180deg, rgba(0,0,0,.45), rgba(0,0,0,.15));
  border-radius: 12px;
}

/* Category cards */
.category-card {
  transition: all 0.3s ease;
  min-height: 64px;
  display: flex;
  align-items: center;
}
.category-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 15px rgba(0,0,0,0.1) !important;
}

/* Product cards */
.product-card {
  transition: all 0.3s ease;
  border-radius: 12px;
  overflow: hidden;
}
.product-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 8px 25px rgba(0,0,0,0.15) !important;
}
.product-image-container { border-radius: 12px 12px 0 0; }

/* Utilities */
.hover-lift:hover { transform: translateY(-5px); }
.hover-shadow:hover { box-shadow: 0 4px 15px rgba(0,0,0,0.1) !important; }
.object-fit-cover { object-fit: cover; }
.transition-all { transition: all 0.3s ease; }
.text-truncate { overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }

/* Mobile tweaks */
@media (max-width: 575.98px) {
  .hero-banner { min-height: 180px; }
}
</style>
{% endblock %}
